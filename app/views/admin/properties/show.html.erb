<!-- No final do arquivo admin/properties/show.html.erb, substitua o script atual por: -->

<!-- Script para galeria -->
<script>
// Aguarda o evento turbo:load para compatibilidade com Turbo
document.addEventListener('turbo:load', function() {
  
  function initSpotlight() {
    if (typeof Spotlight !== 'undefined') {
      Spotlight.init({
        fit: 'contain',
        animation: 'slide',
        theme: 'dark',
        control: ['zoom', 'rotate', 'close'],
        keyboard: true,
        spinner: true,
        title: true,
        description: false,
        counter: true,
        progress: true,
        autohide: true,
        infinite: true
      });
    } else {
      // Tenta novamente após 100ms
      setTimeout(initSpotlight, 100);
    }
  }

  // Functionality for changing main image
  const mainImage = document.getElementById('mainImage');
  const mainImageLink = mainImage?.parentElement;
  const thumbnails = document.querySelectorAll('.image-thumb');

  // Switch main image when clicking thumbnails
  thumbnails.forEach(thumb => {
    thumb.addEventListener('click', function(e) {
      e.preventDefault();
      
      const newImageUrl = this.dataset.imageUrl;
      const newTitle = this.dataset.title;
      
      // Update main image
      if (mainImage) {
        mainImage.src = newImageUrl;
      }
      
      // Update main image link for spotlight
      if (mainImageLink) {
        mainImageLink.href = newImageUrl;
        mainImageLink.dataset.title = newTitle;
      }
      
      // Update active thumbnail
      thumbnails.forEach(t => {
        const ring = t.querySelector('span:last-child');
        if (ring) ring.classList.remove('ring-indigo-500');
      });
      const currentRing = this.querySelector('span:last-child');
      if (currentRing) currentRing.classList.add('ring-indigo-500');
    });
  });

  // Set first thumbnail as active by default
  if (thumbnails.length > 0) {
    const firstRing = thumbnails[0].querySelector('span:last-child');
    if (firstRing) firstRing.classList.add('ring-indigo-500');
  }

  // Initialize Spotlight with delay
  setTimeout(initSpotlight, 200);
});

// Limpar Spotlight ao sair da página
document.addEventListener('turbo:before-cache', function() {
  if (typeof Spotlight !== 'undefined') {
    try {
      Spotlight.destroy();
    } catch (e) {
      console.log("Spotlight já foi destruído");
    }
  }
});
</script>